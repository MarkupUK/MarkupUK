
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Aggregation</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2019 Proceedings" /><link rel="up" href="ar11s04s02.html" title="Execution steps" /><link rel="prev" href="ar11s04s02s02.html" title="Transformation" /><link rel="next" href="ar11s05.html" title="Conclusion" /><!--  Generated with Oxygen version 21.0, build number 2019032613.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.1.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2019032613" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar11s04s02s02.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar11s05.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="sect3" id="d5e5540"><div class="titlepage"><div><div><h4 class="title">Aggregation</h4></div></div></div><p>The most challenging step in this data flow is to re-model the relational data
                    into aggregated, hierarchical data. A relational database table becomes one (or
                    more) XML document during the data export, which can be quite large, often
                    several gigabytes. During the aggregation, we need to "​<span class="italic">join</span>​" these large "<span class="emphasis"><em>table
                    documents</em></span>".</p><p>We can use SAX, StAX or XSLT streaming mode to process large files, but the
                    parallel processing of several large documents is problematic. Here comes the
                    power of an XML database and XQuery. Configuring proper indexes is a
                    must.</p><p>As I have described before, the complexity of the XQuery is not too bad, since
                    we tend to reuse the same patterns multiple times.</p><p>This XQuery is specific to the database schema we work with, and cannot be
                    written generically. This query script is the only part of the data pipeline
                    which is custom made for each relational database schema; the other operations
                    are generic and work with any database.</p><p>Most importantly, we need to have a decent knowledge of the relational
                    database schema, and also the end user requirements about how this data will be
                    searched and used.</p><div class="example" id="d5e5549"><p class="title"><strong>Example 6. Aggregated records in hierarchical XML:</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">
&lt;travels&gt;
    &lt;travel id="t1"&gt;
        &lt;date&gt;2019-05-15&lt;/date&gt;
        &lt;reason&gt;Customer meeting in Oslo&lt;/reason&gt;
        &lt;employee id="e1"&gt;
            &lt;first-name&gt;Ola&lt;/first-name&gt;
            &lt;second-name&gt;Nordmann&lt;/second-name&gt;
        &lt;/employee&gt;
        &lt;transactions&gt;
            &lt;transaction id="c1"&gt;
               &lt;item-name&gt;bus ticket&lt;/item-name&gt;
               &lt;cost currency="NOK"&gt;100&lt;/cost&gt;
            &lt;/transaction&gt;
            &lt;transaction id="c2"&gt;
                &lt;item-name&gt;accommodation&lt;/item-name&gt;
                &lt;cost currency="NOK"&gt;1000&lt;/cost&gt;
            &lt;/transaction&gt;
        &lt;/transactions&gt;
    &lt;/travel&gt;
    &lt;travel&gt;...&lt;/travel&gt;
    ...
&lt;/travels&gt;</pre></div></div><br class="example-break" clear="none" /><p>It's also possible that the data from one database is not aggregated into a
                    single list of records, but into multiple lists of records using different XML
                    schemas.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar11s04s02s02.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="ar11s04s02.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar11s05.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>