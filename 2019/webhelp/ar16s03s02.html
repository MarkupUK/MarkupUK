
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Lambda Configuration</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2019 Proceedings" /><link rel="up" href="ar16s03.html" title="Technical Configuration" /><link rel="prev" href="ar16s03s01.html" title="Linking Git to S3" /><link rel="next" href="bug_fixes.html" title="Analysis and Discussion" /><!--  Generated with Oxygen version 21.0, build number 2019032613.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.1.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2019032613" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar16s03s01.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="bug_fixes.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="section" id="d5e6944"><div class="titlepage"><div><div><h3 class="title">Lambda Configuration</h3></div></div></div><p>This configuration covers point 6 and 7 of the diagram. In particular, it describes the configuration for setting up the lambda function running XSpec tests. This entails:

            </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Retrieving the GitHub code stored in a zip file in S3.</p></li><li class="listitem"><p>Unzipping the file and storing it in a local directory accessible by the lambda function.</p></li><li class="listitem"><p>Setting up environment variables required by XSpec (i.e. paths to Saxon and HTML report).</p></li><li class="listitem"><p>Running the XSpec test suite for all the XSpec tests stored in a given directory.</p></li><li class="listitem"><p>Storing the HTML report in S3.</p></li><li class="listitem"><p>Notifying the developer in case a test failed and providing a link for accessing the HTML report in S3.</p></li></ol></div><p>
        </p><p>A step-by-step guide to replicate this configuration and the code for the lambda function is available in my GitHub account <a class="xref" href="bi14.html#markupuk2019" title="Markup UK 2019" shape="rect">[markupuk2019]</a>. It is worth highlighting the following points:

            </p><div xmlns:svg="http://www.w3.org/2000/svg" class="itemizedlist"><ul class="itemizedlist" style=""><li class="listitem"><p><span class="bold"><strong>Custom Runtime</strong></span>: AWS Lambda natively supports lambda functions written in Java, Go, PowerShell, Node.js, C#, Python, and Ruby. AWS Lambda also provides a Runtime API allowing to implement the lambda function in any programming language <a class="xref" href="bi14.html#custom_runtime" title="Custom AWS Lambda Runtimes" shape="rect">[custom_runtime]</a>. I used the latter approach and implemented the lambda function in bash as calling the <code class="code">xspec.sh</code> shell script is the simplest way to run the XSpec test suite. However, the lambda function could be re-written using virtually any programming language.</p></li><li class="listitem"><p><span class="bold"><strong>Layers</strong></span>: the lambda function makes use of layers <a class="xref" href="bi14.html#layers" title="AWS Lambda Layers" shape="rect">[layers]</a>. A layer is a zip file containing additional libraries and dependencies. In particular, I used layers for the XSpec runtime, the Saxon HE jar file, and bash <a class="xref" href="bi14.html#bash_layer" title="Bash Lambda Layer" shape="rect">[bash_layer]</a>. It is also possible to add a layer for Apache Ant and run the XSpec test suite via Ant which can speed up the test suite execution. </p></li><li class="listitem"><p><span class="bold"><strong>Memory and Time Settings</strong></span>: these are configured in the settings for the lambda function. As running large XSpec test suites can be memory and time intensive, I recommend to adapt the values of memory and timeout accordingly. In my experience 512 MB memory and 2 minute timeout is a minimum threshold for running few XSpec tests.</p></li><li class="listitem"><p><span class="bold"><strong>IAM configuration</strong></span>: the lambda function is granted permissions to interact with other AWS services like S3 and SNS via a IAM role <a class="xref" href="bi14.html#iam_role" title="IAM Roles" shape="rect">[iam_role]</a>. It is a good security practice to allow access only to the relevant S3 buckets.</p></li><li class="listitem"><p><span class="bold"><strong>Notification</strong></span>: I configured the lambda function to send email notifications via SNS (<a class="xref" href="ar16s03s02.html#email_notification" title="Figure 3. Email notification" shape="rect">Figure 3, “Email notification”</a> shows an example of email notification with a failed test). It is also possible to configure SNS to send notifications to a chat messaging service like Slack and this may be more appropriate for large development teams. 

            </p><div class="figure" id="email_notification"><p class="title"><strong>Figure 3. Email notification</strong></p><div class="figure-contents"><div class="mediaobject"><img src="papers-2019/sandro/images/email_notification.png" width="429" alt="Email notification" /></div></div></div><p><br class="figure-break" clear="none" />
</p></li><li class="listitem"><p><span class="bold"><strong>CI Workflow</strong></span>: the lambda function is configured to stop as soon as a test fails: this is done in order to reduce the execution time and to lower costs. However, it is possible to adapt the lambda function to run the full test suite and report all the failing tests in the notification.</p></li><li class="listitem"><p><span class="bold"><strong>Troubleshooting</strong></span>: debugging a lambda function can be challenging as the environment upon which it runs is stateless. Using CloudWatch to monitor the execution of the function and outputting the results of commands to the CloudWatch logs is extremely useful for troubleshooting.</p></li></ul></div><p>
        </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar16s03s01.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="ar16s03.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="bug_fixes.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>