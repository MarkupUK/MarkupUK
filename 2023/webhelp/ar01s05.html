
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Design pattern 1: Job tickets</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2023 Proceedings" /><link rel="up" href="ar01.html" title="XProc as a command-line application engine" /><link rel="prev" href="ar01s04.html" title="Is XProc a suitable language?" /><link rel="next" href="ar01s05s01.html" title="The job ticket" /><!--  Generated with Oxygen version 24.0, build number 2021121511.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.5.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2021121511" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar01s04.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar01s05s01.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="section" id="d5e108"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Design pattern 1: Job tickets</h2></div></div></div><p>The thing that really helped writing this application well was working with what I call a “job
      ticket”. A job ticket is some kind of description of what the application has to do: get these files, copy
      them there, transform these using that stylesheet, store the result there, etc. A job ticket format can be seen as
      a Domain Specific Language (DSL). </p><p>I use XML as the job ticket’s format, but other (XProc supported) formats, like JSON, are of course also
      possible. </p><p>Let’s assume we have such a job ticket (more about this later). The clue to efficiently process this in
      XProc was in making it the <span class="emphasis"><em>primary</em></span> document that flows through the pipeline:</p><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td rowspan="1" colspan="1"><img src="papers-2023/siegel/images/processing-1.png" width="100%" /></td></tr></table></div><p>Usually the documents the pipeline is about are the primary ones, the drivers of the process. But in this
      case, since we were doing what the job ticket prescribed, it turned out to be way easier to let the job ticket
      determine the flow. The underlying application logic became simpler and easier to understand.</p><p>However, there are of course still the (data) documents that are processed/produced to cater with. The way to
      handle this is add <span class="emphasis"><em>another port</em></span> on the processing steps and pass them on through this:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td rowspan="1" colspan="1"><img src="papers-2023/siegel/images/processing-2.png" width="100%" /></td></tr></table></div></div><p>In XProc, that’s easy to do, just add another (non-primary) port in the step’s prolog:</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;p:declare-step</strong> <span class="hl-attribute" style="color: #F5844C">…</span> <span class="hl-attribute" style="color: #F5844C">type</span>=<span class="hl-value" style="color: #993300">"steps:step2"</span> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"step2"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>

  <em class="hl-comment" style="color: silver">&lt;!-- The job ticket is passed, unchanged --&gt;</em>
  <strong class="hl-tag" style="color: #000096">&lt;p:input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"source"</span> <span class="hl-attribute" style="color: #F5844C">primary</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong> 
  <strong class="hl-tag" style="color: #000096">&lt;p:output</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span> <span class="hl-attribute" style="color: #F5844C">primary</span>=<span class="hl-value" style="color: #993300">"true"</span> <span class="hl-attribute" style="color: #F5844C">pipe</span>=<span class="hl-value" style="color: #993300">"source@step2"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>

  <strong class="hl-tag" style="color: #000096">&lt;!–</strong> <span class="hl-attribute" style="color: #F5844C">Documents</span> <span class="hl-attribute" style="color: #F5844C">are</span> <span class="hl-attribute" style="color: #F5844C">passed</span> <span class="hl-attribute" style="color: #F5844C">using</span> <span class="hl-attribute" style="color: #F5844C">another</span> <span class="hl-attribute" style="color: #F5844C">port</span> <span class="hl-attribute" style="color: #F5844C">(if</span> <span class="hl-attribute" style="color: #F5844C">necessary)</span> <span class="hl-attribute" style="color: #F5844C">--&gt;</span>
  <span class="hl-attribute" style="color: #F5844C">&lt;p:input</span> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"docs-in"</span> <span class="hl-attribute" style="color: #F5844C">primary</span>=<span class="hl-value" style="color: #993300">"false"</span> <span class="hl-attribute" style="color: #F5844C">sequence</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;p:output</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"docs-out"</span> <span class="hl-attribute" style="color: #F5844C">primary</span>=<span class="hl-value" style="color: #993300">"false"</span> <span class="hl-attribute" style="color: #F5844C">sequence</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>

  …

<strong class="hl-tag" style="color: #000096">&lt;/p:declare-step&gt;</strong></pre><div xmlns:svg="http://www.w3.org/2000/svg" class="itemizedlist"><ul class="itemizedlist" style=""><li class="listitem"><p>The primary output port (called <code class="code">result</code>) is defined in such a way (using its <code class="code">pipe</code>
          attribute) that it passes what flows in on the input port (called <code class="code">source</code>) unchanged.</p></li><li class="listitem"><p>The <code class="code">docs-in</code> and <code class="code">docs-out</code> ports are defined as <code class="code">sequence="true"</code>,
          meaning they can handle a sequence (zero or more) documents flowing through.</p></li></ul></div><p>And here is an example of how to chain steps like this in an encompassing step:</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;p:declare-step</strong> <span class="hl-attribute" style="color: #F5844C">…</span> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"encompassing-step"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>

  … (acquire job ticket)

  <strong class="hl-tag" style="color: #000096">&lt;steps:step1</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"step1-invocation"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>

  <strong class="hl-tag" style="color: #000096">&lt;steps:step2</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"step2-invocation"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;p:with-input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"docs-in"</span> <span class="hl-attribute" style="color: #F5844C">pipe</span>=<span class="hl-value" style="color: #993300">"docs-out@step-1-invocation"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/steps:step2&gt;</strong>

  <strong class="hl-tag" style="color: #000096">&lt;steps:step3</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"step3-invocation"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;p:with-input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"docs-in"</span> <span class="hl-attribute" style="color: #F5844C">pipe</span>=<span class="hl-value" style="color: #993300">"docs-out@step-2-invocation"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/steps:step3&gt;</strong>

<strong class="hl-tag" style="color: #000096">&lt;/p:declare-step&gt;</strong></pre><p>The primary document (the job ticket) “falls through” the steps, because of the implicit primary
      port connections. The document port connections need to made explicit.</p><p>If you need to produce console messages during processing you can use the <code class="code">message</code> attribute on
      steps:</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;p:file-copy</strong> <span class="hl-attribute" style="color: #F5844C">message</span>=<span class="hl-value" style="color: #993300">"* Copying {$hrefTarget} to {$hrefTarget}"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>

<strong class="hl-tag" style="color: #000096">&lt;p:xslt</strong> <span class="hl-attribute" style="color: #F5844C">message</span>=<span class="hl-value" style="color: #993300">"* Transforming …"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  …
<strong class="hl-tag" style="color: #000096">&lt;/p:xslt&gt;</strong></pre></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar01s04.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="ar01.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar01s05s01.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>