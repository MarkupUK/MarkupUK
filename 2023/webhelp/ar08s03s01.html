
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Level 1 titles</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2023 Proceedings" /><link rel="up" href="ar08s03.html" title="Implementation" /><link rel="prev" href="ar08s03.html" title="Implementation" /><link rel="next" href="ar08s03s02.html" title="Next titles and list items" /><!--  Generated with Oxygen version 24.0, build number 2021121511.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.5.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2021121511" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar08s03.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar08s03s02.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="section" id="d5e1982"><div class="titlepage"><div><div><h3 class="title">Level 1 titles</h3></div></div></div><p>We want to transform a <code class="code"># Title 1</code> line into an XML element <code class="code">&lt;title&gt;Title 1&lt;/title&gt;</code>.</p><p>Test Driven Development says we <span class="emphasis"><em>must</em></span> write a test that describes the business
        requirement, before coding any production code. XSpec is a framework where we can describe business
        requirements as scenarios, with context and expectations.</p><p>Let's write such a scenario</p><div class="example" id="d5e1990"><p class="title"><strong>Example 1. XSpec 1</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;x:description</strong> 
  <span class="hl-attribute" style="color: #F5844C">xmlns:x</span>=<span class="hl-value" style="color: #993300">"http://www.jenitennison.com/xslt/xspec"</span>
  <span class="hl-attribute" style="color: #F5844C">stylesheet</span>=<span class="hl-value" style="color: #993300">"../../main/xsl/md-to-xml.xsl"</span>
  <span class="hl-attribute" style="color: #F5844C">xslt-version</span>=<span class="hl-value" style="color: #993300">"3.0"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>

  <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"Title 1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:context</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"'# Title 1'"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:expect</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"A title element with text in"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Title 1<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/x:expect&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/x:description&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>If we run this XSpec scenario, it fails, and says that <code class="code">../../main/xsl/md-to-xml.xsl
        does not exist</code>. Correct. A test that does not compile is a failing test. We are allowed
        to write production code to make the test compile.</p><p>So we create the missing file, with the minimum code to make the test compile.</p><div class="example" id="d5e1996"><p class="title"><strong>Example 2. XSLT 1</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;xsl:stylesheet</strong> 
  <span class="hl-attribute" style="color: #F5844C">xmlns:xsl</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/1999/XSL/Transform"</span>
  <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"3.0"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  
<strong class="hl-tag" style="color: #000096">&lt;/xsl:stylesheet&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>With this file, the unit tests executes, but fails to succeed. We can now write the minimum
        code to make the test succeed :</p><div class="example" id="d5e2000"><p class="title"><strong>Example 3. XSLT 2</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;xsl:stylesheet</strong> 
  <span class="hl-attribute" style="color: #F5844C">xmlns:xsl</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/1999/XSL/Transform"</span>
  <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"3.0"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">".[. eq '# Title 1']"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Title 1<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:template&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/xsl:stylesheet&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>If we run again the unit test, it now succeeds. First part of TDD loop is completed, the code
        behaves as expected. But the code is very specific, and not very easy to understand ; business
        intention can not be quickly understood, and that's a problem. In [<a href="marchand-references.html#clean-code" class="biblioref" title="[Clean Code]" shape="rect"><abbr class="abbrev">Clean Code</abbr></a>],
        Bob Martin explains that we have to improve readability, it makes code easier to maintain.</p><p>To refactor code, we can process by hand, and apply manually various refactoring operations, like
        Extract Function[<a href="marchand-references.html#REFACTO-extract-function" class="biblioref" title="[Refactoring Extract Function]" shape="rect"><abbr class="abbrev">Refactoring Extract Function</abbr></a>] ; we can also use OXygen's implementation of
        this operation, it will be quicker :</p><div xmlns:svg="http://www.w3.org/2000/svg" class="itemizedlist"><ul class="itemizedlist" style=""><li class="listitem"><p>Select <code class="code">. eq '#Title 1'</code></p></li><li class="listitem"><p>Right Click on it / Refactoring / Extract Function</p></li><li class="listitem"><p>It asks for a function name, let's type <code class="code">prv:isTitle1</code> and validate</p></li><li class="listitem"><p>OXygen generates the function, defines the namespace alias, and replace the ugly code by the function call :</p></li></ul></div><div class="example" id="d5e2018"><p class="title"><strong>Example 4. XSLT 3</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;xsl:stylesheet</strong> 
  <span class="hl-attribute" style="color: #F5844C">xmlns:xsl</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/1999/XSL/Transform"</span>
  <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"3.0"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:prv</span>=<span class="hl-value" style="color: #993300">"http://www.example.com/fn"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">". eq '# Title 1'"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">".[prv:isTitle1()]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Title 1<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:template&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/xsl:stylesheet&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>Let's run again the unit test, it fails. The function does not have any parameter, no context
      item, so it can not compare text. Let's introduce a parameter ; OXygen does not provide a Introduce
      parameter[<a href="marchand-references.html#REFACTO-introduce-parameter-object" class="biblioref" title="[Refactoring Introduce Parameter]" shape="rect"><abbr class="abbrev">Refactoring Introduce Parameter</abbr></a>] nor a Change function declaration[<a href="marchand-references.html#REFACTO-change-function-declaration" class="biblioref" title="[Refactoring Change Function Declaration]" shape="rect"><abbr class="abbrev">Refactoring Change Function Declaration</abbr></a>],
      so we have to do it manually :</p><div class="example" id="d5e2024"><p class="title"><strong>Example 5. XSLT 4</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;xsl:stylesheet</strong> 
  <span class="hl-attribute" style="color: #F5844C">xmlns:xsl</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/1999/XSL/Transform"</span>
  <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"3.0"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:prv</span>=<span class="hl-value" style="color: #993300">"http://www.example.com/fn"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:xs</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"line"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$line eq '# Title 1'"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">".[prv:isTitle1(.)]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Title 1<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:template&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/xsl:stylesheet&gt;</strong>
</pre></div></div><br class="example-break" clear="none" /><p>The test succeeds. But function is at the beginning of the code, and it hides the business
      part. Let's apply the Slide Statement[<a href="marchand-references.html#REFACTO-slide-statement" class="biblioref" title="[Refactoring Slide Statement]" shape="rect"><abbr class="abbrev">Refactoring Slide Statement</abbr></a>] refactoring operation, to move
      the function at the bottom of the file :</p><div class="example" id="d5e2029"><p class="title"><strong>Example 6. XSLT 5</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;xsl:stylesheet</strong> 
  <span class="hl-attribute" style="color: #F5844C">xmlns:xsl</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/1999/XSL/Transform"</span>
  <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"3.0"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:prv</span>=<span class="hl-value" style="color: #993300">"http://www.example.com/fn"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:xs</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">".[prv:isTitle1(.)]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Title 1<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:template&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"line"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$line eq '# Title 1'"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/xsl:stylesheet&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>Now, we can read the XSL file, and understand that it is used to convert all lines that are a
      <code class="code">title1</code>, and transform it to a random element. We do not need to know exactly what is a
      <code class="code">title1</code>, and which technical rules apply to identify a <code class="code">title1</code>. We just know
      that this template processes all <code class="code">title1</code> lines.</p><p>This second part of TDD loop, the refactoring part, is the most important phase of TDD. It's the
      phase where we make business rules emerge from the code.</p><p>What a pitty, Oxygen is not very precise in refactoring, and it generates code that has to be
      manually fixed. The generated function should be typed as boolean, but isn't. It's an error,
      and we know this because we have good skills in XSLT. But we can not write new code without a failing
      test. So we write a test that shows the function is not correct and must return a <code class="code">xs:boolean</code>.</p><div class="example" id="d5e2040"><p class="title"><strong>Example 7. XSpec 2</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;x:description</strong> 
  <span class="hl-attribute" style="color: #F5844C">xmlns:x</span>=<span class="hl-value" style="color: #993300">"http://www.jenitennison.com/xslt/xspec"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:prv</span>=<span class="hl-value" style="color: #993300">"http://www.example.com/fn"</span>
  <span class="hl-attribute" style="color: #F5844C">stylesheet</span>=<span class="hl-value" style="color: #993300">"../../main/xsl/md-to-xml.xsl"</span>
  <span class="hl-attribute" style="color: #F5844C">xslt-version</span>=<span class="hl-value" style="color: #993300">"3.0"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"Title 1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:context</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"'# Title 1'"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:expect</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"A title element with text in"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Title 1<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/x:expect&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong>    
  
  <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"testing isTitle1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"# Title 1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:call</strong> <span class="hl-attribute" style="color: #F5844C">function</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;x:param&gt;</strong># Title 1<strong class="hl-tag" style="color: #000096">&lt;/x:param&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/x:call&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:expect</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"Title 1"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"true()"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/x:description&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>Here, we precisely define we expect a <code class="code">xs:boolean</code>. We we run the test, it fails. Types are different.
        Let's correct production code just add <code class="code">as</code> attribute :</p><div class="example" id="d5e2046"><p class="title"><strong>Example 8. XSLT 6</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:boolean"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"line"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$line eq '# Title 1'"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>And here, Oxygen shows a warning on mis-use of value-of. We replace it with a sequence :</p><div class="example" id="d5e2050"><p class="title"><strong>Example 9. XSLT 7</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:boolean"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"line"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$line eq '# Title 1'"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>Now, all tests are green.</p><p>We now can add new test cases for titles. XSpec allows to wrap scenarios into scenarios, it is
        very useful to group scenarios together ; that's what we do here, to check if our <code class="code">isTitle1</code>
        function is correct :</p><div class="example" id="d5e2056"><p class="title"><strong>Example 10. XSpec 3</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">  <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"testing isTitle1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"# Title 1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:call</strong> <span class="hl-attribute" style="color: #F5844C">function</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;x:param&gt;</strong># Title 1<strong class="hl-tag" style="color: #000096">&lt;/x:param&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/x:call&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:expect</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"true"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"true()"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"# Another title 1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:call</strong> <span class="hl-attribute" style="color: #F5844C">function</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;x:param&gt;</strong># Another title 1<strong class="hl-tag" style="color: #000096">&lt;/x:param&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/x:call&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:expect</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"true"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"true()"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>The new scenario fails, our function is not correctly written. As we have read
        the Markdown specification, we know that a level 1 title must starts with <code class="code"># </code>,
        so we code this :</p><div class="example" id="d5e2061"><p class="title"><strong>Example 11. XSLT 8</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:boolean"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"line"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$line =&gt; starts-with('# ')"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>And all tests succeed.</p><p>Last, we have to test that the produced <code class="code">title</code> element contains the correct text.
        So we write a new scenario with a different text. And we refactor scenarios titles, to be clearer :</p><div class="example" id="d5e2067"><p class="title"><strong>Example 12. XSpec 4</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">  <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"Exercise Book title"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"Title 1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:context</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"'# Title 1'"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:expect</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"A title element with text in"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Title 1<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/x:expect&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;x:scenario</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"Another title 1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:context</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"'# Another title 1'"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;x:expect</strong> <span class="hl-attribute" style="color: #F5844C">label</span>=<span class="hl-value" style="color: #993300">"A title element with Another title 1 in"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
        <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Another title 1<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/x:expect&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/x:scenario&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>This new scenario fails, we can correct the template to produce the expected output :</p><div class="example" id="d5e2071"><p class="title"><strong>Example 13. XSLT 9</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">  <strong class="hl-tag" style="color: #000096">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">".[prv:isTitle1(.)]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span> <span class="hl-attribute" style="color: #F5844C">expand-text</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>{. =&gt; substring(3)}<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:template&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>This new code make all scenarios succeed. We are done with implementation for level 1 titles,
        but code is not very understandable : what does <code class="code">. =&gt; substring(3)</code> mean from a business
        point of view ? Nothing, it's too technical. Let's add clarity, and extract all the thecnical code
        in a function :</p><div class="example" id="d5e2076"><p class="title"><strong>Example 14. XSLT 10</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:getTitle1Content"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"line"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$line =&gt; substring(3)"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">".[prv:isTitle1(.)]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span> <span class="hl-attribute" style="color: #F5844C">expand-text</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>{prv:getTitle1Content(.)}<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:template&gt;</strong></pre></div></div><br class="example-break" clear="none" /><p>And again, move function to the bottom of file, it's only technical details... Now, if we look
        at our code, we have a template where the match attribute contains an understable business rule, and
        it produces an output that is also described by a business rule. All rules are clearly defined in the
        code. This code will be much simpler to maintain if business rules evolve in the future, and if
        developers who write the initial code are not still active on the project. We can read the code from
        top to bottom, as a book.</p><div class="example" id="d5e2080"><p class="title"><strong>Example 15. XSLT 11</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;xsl:stylesheet</strong> 
  <span class="hl-attribute" style="color: #F5844C">xmlns:xsl</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/1999/XSL/Transform"</span>
  <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"3.0"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:prv</span>=<span class="hl-value" style="color: #993300">"com:oxiane:courses:mdtoxml:private"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:xs</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/2001/XMLSchema"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;xsl:mode</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"convert"</span> <span class="hl-attribute" style="color: #F5844C">on-no-match</span>=<span class="hl-value" style="color: #993300">"fail"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;xsl:template</strong> <span class="hl-attribute" style="color: #F5844C">match</span>=<span class="hl-value" style="color: #993300">".[prv:isTitle1(.)]"</span> <span class="hl-attribute" style="color: #F5844C">mode</span>=<span class="hl-value" style="color: #993300">"convert"</span> <span class="hl-attribute" style="color: #F5844C">expand-text</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>{prv:getTitle1Content(.)}<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:template&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:isTitle1"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:boolean"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"line"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:sequence</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$line =&gt; starts-with('# ')"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong>

  <strong class="hl-tag" style="color: #000096">&lt;xsl:function</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"prv:getTitle1Content"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:param</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"line"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;xsl:value-of</strong> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"$line =&gt; substring(3)"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/xsl:function&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/xsl:stylesheet&gt;</strong></pre></div></div><br class="example-break" clear="none" /></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar08s03.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="ar08s03.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar08s03s02.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>