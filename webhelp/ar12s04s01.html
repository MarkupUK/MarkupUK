
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Use of Maps for Returned Values</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2018 Proceedings" /><link rel="up" href="ar12s04.html" title="Implementation" /><link rel="prev" href="ar12s04.html" title="Implementation" /><link rel="next" href="ar12s04s02.html" title="Declaring Map Types" /><!--  Generated with Oxygen version 20.0-SNAPSHOT, build number 2018042310.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.1.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2018042310" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar12s04.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar12s04s02.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="sect2" id="d5e5136"><div class="titlepage"><div><div><h3 class="title">Use of Maps for Returned Values</h3></div></div></div><p>A classic problem with functional programming is that a function can only return one result. If you want to compute two values
            (say a maximum and minimum) from the same input then you have two choices. You can either process the input more than once (which may
            involve some redundant computation), or you can return a composite result.</p><p>In this application there are many cases where we need to return a composite result. </p><p>To take an example, suppose we are validating an attribute, and we find that the declared type for that attribute
            is a user-defined list type, where the item type of the list is <code class="code">part-number</code>, and <code class="code">part-number</code>
                is derived from <code class="code">xs:ID</code>. The calling code wants to know (a) whether the attribute is valid against its declared type;
                (b) what error messages to report if not; and (c) whether the value contains any <code class="code">xs:ID</code> or <code class="code">xs:IDREF</code>
                values that need to be added to global tables of <code class="code">xs:ID</code> and <code class="code">xs:IDREF</code> values for document-level
                validity checking at the end.</p><p>Our solution to this is that we recurse through the instance document in a tree-walk driven by <code class="code">xsl:apply-templates</code>
                in the normal way, but the return value from <code class="code">xsl:apply-templates</code> is a map containing all the information gleaned
            from the processing of this subtree.</p><p>Very often the information returned from several calls on <code class="code">xsl:apply-templates</code> (for example, one call for child elements
            and another for attributes) will need to be combined into a single map. At the top level, when we return from the initial call on
                <code class="code">xsl:apply-templates</code> on the root node, all the information that is needed to produce the validation report is present in
            one large map, and the final stage of processing takes this map and generates the XML report.</p><p>The maps that are produced by the different processing stages thus typically include some subset of a common set of fields.
            These include:</p><div class="table" id="d5e5155"><p class="title"><strong>Table 1. The structure of maps used to return partial results of processing</strong></p><div class="table-contents"><table><thead><tr><th rowspan="1" colspan="1">Name</th><th rowspan="1" colspan="1">Value</th></tr></thead><tbody><tr><td rowspan="1" colspan="1">valid</td><td rowspan="1" colspan="1">An <code class="code">xs:boolean</code> indicating whether the subtree is valid</td></tr><tr><td rowspan="1" colspan="1">errors</td><td rowspan="1" colspan="1">A set of error objects indicating error information to be included in the validation report</td></tr><tr><td rowspan="1" colspan="1">value</td><td rowspan="1" colspan="1">The typed value of an element or attribute</td></tr><tr><td rowspan="1" colspan="1">type</td><td rowspan="1" colspan="1">The type against which a subtree was validated</td></tr><tr><td rowspan="1" colspan="1">lexical</td><td rowspan="1" colspan="1">The lexical form of an attribute or text node after whitespace normalization</td></tr><tr><td rowspan="1" colspan="1">id</td><td rowspan="1" colspan="1">A set of <code class="code">xs:ID</code> values found in the subtree</td></tr><tr><td rowspan="1" colspan="1">id-map</td><td rowspan="1" colspan="1">A mapping from <code class="code">xs:ID</code> values found in the subtree, to the nodes on which they appeared</td></tr><tr><td rowspan="1" colspan="1">idrefs</td><td rowspan="1" colspan="1">A set of <code class="code">xs:IDREF</code> values found in the subtree</td></tr></tbody></table></div></div><br class="table-break" clear="none" /><p>When two of these maps representing properties of different subtrees are combined, different rules apply to each field.
            For example, for the <code class="code">id</code> and <code class="code">idrefs</code> and <code class="code">errors</code> fields we can take the union of the two values. 
                For the <code class="code">valid</code> property, we can apply a logical AND; a tree is valid only if all its subtrees are valid.
            For <code class="code">value</code> and <code class="code">type</code> we can drop the value; these fields are used only at the next level up, and
            do not propagate all the way to the root.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar12s04.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="ar12s04.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar12s04s02.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>