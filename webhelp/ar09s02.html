
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Rethinking document-to-document transformation</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2018 Proceedings" /><link rel="up" href="ar09.html" title="Rethinking transformation – the potential of code generation" /><link rel="prev" href="ar09s01.html" title="Introduction" /><link rel="next" href="ar09s03.html" title="Source navigation based model" /><!--  Generated with Oxygen version 20.0-SNAPSHOT, build number 2018042310.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.1.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2018042310" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar09s01.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar09s03.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="section" id="d5e2962"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Rethinking document-to-document transformation</h2></div></div></div><p>As a starting point, we introduce a simple example transformation.</p><p>Source document:</p><pre class="programlisting" xml:space="preserve">
resources
. books
. . @lastUpdate?
. . book*
. . . @isbn
. . . title
. . . author*
. . . py?
            </pre><p>Target document:</p><pre class="programlisting" xml:space="preserve">
publications
. @updatedAt?
. publication*
. . @publicationYear?
. . isbn
. . title
. . creator*
. . . creatorRole
. . . creatorName
            </pre><p>The implementation of a transformation can use a push approach or a pull
            approach:</p><div xmlns:svg="http://www.w3.org/2000/svg" class="itemizedlist"><ul class="itemizedlist compact" style=""><li class="listitem"><p>Push approach – the code follows the data structure of the source document,
                    letting it trigger appropriate actions</p></li><li class="listitem"><p>Pull approach – the code follows the data structure of the target document,
                    letting it trigger appropriate actions</p></li></ul></div><p>As a rule of thumb, the push approach is more appropriate when the structure of the
            target document strongly depends on the actual input data, which is typically the case
            with document oriented XML, mainly consisting of human readable text and structured
            according to its actual content. The pull approach, on the other hand, tends to be much
            more straightforward with data oriented XML, where the target document structure is
            mainly determined by the target document model, rather than unpredictable text
            structure.</p><p>In this discussion we focus on pull transformation, as we are interested in leveraging
            the information stored in the target document model. The following listing demonstrates
            the striking similarity between target document structure and code structure, which can
            be achieved using the pull approach.</p><div class="example" id="example-xquery-for-xml-source"><p class="title"><strong>Example 1. XQuery code implementing the example transformation as a pull
                transformation.</strong></p><div class="example-contents"><pre class="programlisting" xml:space="preserve">
let $context := /* return

&lt;<span class="bold"><strong>publications</strong></span>&gt;{
   let $value := $context/books/@lastUpdate return
   if (empty($value)) then () else
   attribute <span class="bold"><strong>updatedAt</strong></span> {$value},
   for $context in $context/books/book return 
   &lt;<span class="bold"><strong>publication</strong></span>&gt;{
      let $v := $context/py return
      if (empty($v)) then () else
      attribute <span class="bold"><strong>publicationYear</strong></span> {$v},   
      &lt;<span class="bold"><strong>isbn</strong></span>&gt;{$context/@isbn/string()}&lt;/isbn&gt;,
      &lt;<span class="bold"><strong>title</strong></span>&gt;{$context/title/string()}&lt;/title&gt;,
      for $context in $context/author return  
      &lt;<span class="bold"><strong>creator</strong></span>&gt;{
         &lt;<span class="bold"><strong>creatorRole</strong></span>&gt;{'Author'}&lt;/creatorRole&gt;,
         &lt;<span class="bold"><strong>creatorName</strong></span>&gt;{$context/string()}&lt;/creatorName&gt;
      }&lt;/creator&gt;
   }&lt;/publication&gt;
}&lt;/publications&gt;</pre></div></div><br class="example-break" clear="none" /><p>Such code is constructed according to a simple pattern:</p><div class="orderedlist"><ol class="orderedlist compact" type="1"><li class="listitem"><p>Instantiate the root element <span class="ital">(write start tag; content
                        will follow)</span></p></li><li class="listitem"><p>For each attribute model on this element model:</p><div class="orderedlist"><ol class="orderedlist compact" type="a"><li class="listitem"><p>Decide whether to construct this attribute</p></li><li class="listitem"><p>If yes: set the value</p></li></ol></div></li><li class="listitem"><p>For each child element model on this element model:</p><div class="orderedlist"><ol class="orderedlist compact" type="a"><li class="listitem"><p>Decide how many instances to construct (possibly none)</p></li><li class="listitem"><p>For each instance:</p><div class="orderedlist"><ol class="orderedlist compact" type="i"><li class="listitem"><p>Instantiate element <span class="ital">(write start tag;
                                        content will follow)</span></p></li><li class="listitem"><p>If element has simple content: set the value</p></li><li class="listitem"><p>If element has attributes/child elements: continue at
                                    (2)</p></li></ol></div></li></ol></div></li></ol></div><p>The example illustrates that the code of a pull transformation can be regarded as a
            sum of two components: a scaffold which reflects the target document model and
            structures the code; and “nuggets” – small pieces of code pulling information from the
            source document. Note the frequent use of the variable $context, whose value is a
            shifting set of source nodes. It provides an appropriate starting point for navigating
            to the nodes of interest, for example:</p><pre class="programlisting" xml:space="preserve">   $context/title</pre><p>Here, the value is always bound to the “right” &lt;book&gt; element, which is the
            &lt;book&gt; currently processed. Such a context is essential for locating the appropriate
            source nodes.</p><p>The transformation can be regarded as a sequence of decisions, which is orchestrated
            by the target document structure. Main kinds of decision are:</p><div class="informaltable" id="decisions"><table class="informaltable" border="0"><colgroup span="1"><col width="14%" class="c1" span="1" /><col width="71%" class="c2" span="1" /><col width="15%" class="c3" span="1" /></colgroup><tbody><tr><td align="left" rowspan="1" colspan="1">• A? </td><td align="left" rowspan="1" colspan="1">- Whether to construct an attribute </td><td align="left" rowspan="1" colspan="1">(2a)</td></tr><tr><td align="left" rowspan="1" colspan="1">• #E? </td><td align="left" rowspan="1" colspan="1">- How many instances of an element to construct</td><td align="left" rowspan="1" colspan="1">(3a)</td></tr><tr><td align="left" rowspan="1" colspan="1">• A=? </td><td align="left" rowspan="1" colspan="1">- Which value to use for an attribute </td><td align="left" rowspan="1" colspan="1">(2b)</td></tr><tr><td align="left" rowspan="1" colspan="1">• E=? </td><td align="left" rowspan="1" colspan="1">- Which value to use for a simple content
                            element</td><td align="left" rowspan="1" colspan="1">(3b.ii)</td></tr></tbody></table></div><p>For following table compiles code snippets, stating the kind of decision they
            implement and identifying the source and target nodes involved.</p><div class="table" id="example-code-snippets"><p class="title"><strong>Table 1. Code snippets taken from the example of a simple pull transformation.</strong></p><div class="table-contents"><table class="table" summary="Code snippets taken from the example of a simple pull transformation." border="1"><colgroup span="1"><col width="30%" class="c1" span="1" /><col width="18%" class="c2" span="1" /><col width="18%" class="c3" span="1" /><col width="21%" class="c4" span="1" /><col width="13%" class="c5" span="1" /></colgroup><thead><tr><th align="left" rowspan="1" colspan="1">Transformation code</th><th align="left" rowspan="1" colspan="1">Source nodes referenced by $context</th><th align="left" rowspan="1" colspan="1">Source nodes</th><th align="left" rowspan="1" colspan="1">Target nodes under construction</th><th align="left" rowspan="1" colspan="1">Decision kind</th></tr></thead><tbody><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/books/@lastUpdate</td><td align="left" rowspan="1" colspan="1">&lt;resources&gt;</td><td align="left" rowspan="1" colspan="1">@lastUpdate</td><td align="left" rowspan="1" colspan="1">@updatedAt</td><td align="left" rowspan="1" colspan="1">A?</td></tr><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/books/@lastUpdate</td><td align="left" rowspan="1" colspan="1">&lt;resources&gt;</td><td align="left" rowspan="1" colspan="1">@lastUpdate</td><td align="left" rowspan="1" colspan="1">@updatedAt</td><td align="left" rowspan="1" colspan="1">A=?</td></tr><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/books/book</td><td align="left" rowspan="1" colspan="1">&lt;resources&gt;</td><td align="left" rowspan="1" colspan="1">&lt;book&gt;</td><td align="left" rowspan="1" colspan="1">&lt;publication&gt;</td><td align="left" rowspan="1" colspan="1">#E?</td></tr><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/py</td><td align="left" rowspan="1" colspan="1">&lt;book&gt;</td><td align="left" rowspan="1" colspan="1">&lt;py&gt;</td><td align="left" rowspan="1" colspan="1">@publicationYear</td><td align="left" rowspan="1" colspan="1">A?</td></tr><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/py</td><td align="left" rowspan="1" colspan="1">&lt;book&gt;</td><td align="left" rowspan="1" colspan="1">&lt;py&gt;</td><td align="left" rowspan="1" colspan="1">@publicationYear</td><td align="left" rowspan="1" colspan="1">A=?</td></tr><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/@isbn/string()</td><td align="left" rowspan="1" colspan="1">&lt;book&gt;</td><td align="left" rowspan="1" colspan="1">@isbn</td><td align="left" rowspan="1" colspan="1">&lt;isbn&gt;</td><td align="left" rowspan="1" colspan="1">E=?</td></tr><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/title/string()</td><td align="left" rowspan="1" colspan="1">&lt;book&gt;</td><td align="left" rowspan="1" colspan="1">&lt;title&gt;</td><td align="left" rowspan="1" colspan="1">&lt;title&gt;</td><td align="left" rowspan="1" colspan="1">E=?</td></tr><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/author</td><td align="left" rowspan="1" colspan="1">&lt;book&gt;</td><td align="left" rowspan="1" colspan="1">&lt;author&gt;</td><td align="left" rowspan="1" colspan="1">&lt;creator&gt;</td><td align="left" rowspan="1" colspan="1">#E=?</td></tr><tr><td align="left" rowspan="1" colspan="1">'Author'</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">-</td><td align="left" rowspan="1" colspan="1">&lt;creatorRole&gt;</td><td align="left" rowspan="1" colspan="1">E=?</td></tr><tr><td align="left" rowspan="1" colspan="1"><span class="bold"><strong>$context</strong></span>/string()</td><td align="left" rowspan="1" colspan="1">&lt;author&gt;</td><td align="left" rowspan="1" colspan="1">&lt;author&gt;</td><td align="left" rowspan="1" colspan="1">&lt;creatorName&gt;</td><td align="left" rowspan="1" colspan="1">E=?</td></tr></tbody></table></div></div><br class="table-break" clear="none" /><p>This example suggests a great potential for code generation based on the target
            document model. This is best prepared by introducing a few abstractions.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar09s01.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="ar09.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar09s03.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>