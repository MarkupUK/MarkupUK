
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>cx:selenium</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2025 Proceedings" /><link rel="up" href="markupuk2025.html" title="Surfing the web with XProc" /><link rel="prev" href="ar07s03.html" title="Enter Invisible XML" /><link rel="next" href="ar07s05.html" title="Security implications" /><!--  Generated with Oxygen version 24.0, build number 2022011710.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.5.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2022011710" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar07s03.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar07s05.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="section" id="d5e2185"><div class="titlepage"><div><div><h2 class="title" style="clear: both">cx:selenium</h2></div></div></div><p>The 
<a class="link" href="https://docs.xmlcalabash.com/reference/current/cx-selenium.html" target="_top" shape="rect"><code class="sgmltag-element">cx:selenium</code>
step</a> is an atomic step:</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;p:declare-step</strong> <span class="hl-attribute" style="color: #F5844C">type</span>=<span class="hl-value" style="color: #993300">"cx:selenium"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;p:input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"source"</span> <span class="hl-attribute" style="color: #F5844C">content-types</span>=<span class="hl-value" style="color: #993300">"text xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;p:output</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span> <span class="hl-attribute" style="color: #F5844C">sequence</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;p:option</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"browser"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string?"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;p:option</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"capabilities"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"map(xs:QName, item())?"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;p:option</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"arguments"</span> <span class="hl-attribute" style="color: #F5844C">as</span>=<span class="hl-value" style="color: #993300">"xs:string*"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/p:declare-step&gt;</strong></pre><p>Here’s a pipeline that uses <code class="sgmltag-element">cx:selenium</code> instead of
<code class="sgmltag-element">p:load</code> to get a web page. Like our earlier pipeline, this one loads a
page and serializes it. But this time, it loads the page with Selenium, allowing
the browser to evaluate any scripts it contains:</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;p:declare-step</strong> <span class="hl-attribute" style="color: #F5844C">xmlns:p</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/ns/xproc"</span>&#xD;
                <span class="hl-attribute" style="color: #F5844C">xmlns:cx</span>=<span class="hl-value" style="color: #993300">"http://xmlcalabash.com/ns/extensions"</span>&#xD;
                <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"main"</span> <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"3.1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;p:import</strong> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"https://xmlcalabash.com/ext/library/selenium.xpl"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;p:output</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;p:option</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"uri"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>&#xD;
&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;cx:selenium&gt;</strong>&#xD;
    <strong class="hl-tag" style="color: #000096">&lt;p:with-option</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"arguments"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"('--headless')"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>&#xD;
    <strong class="hl-tag" style="color: #000096">&lt;p:with-input&gt;</strong>&#xD;
      <strong class="hl-tag" style="color: #000096">&lt;p:inline</strong> <span class="hl-attribute" style="color: #F5844C">content-type</span>=<span class="hl-value" style="color: #993300">"text/plain"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>script version 0.2 .&#xD;
      page "{$uri}" .&#xD;
      pause PT0.5S .&#xD;
      output to result .&#xD;
      <strong class="hl-tag" style="color: #000096">&lt;/p:inline&gt;</strong>&#xD;
    <strong class="hl-tag" style="color: #000096">&lt;/p:with-input&gt;</strong>&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;/cx:selenium&gt;</strong>&#xD;
<strong class="hl-tag" style="color: #000096">&lt;/p:declare-step&gt;</strong>&#xD;
</pre><p>Running that script gives us table data:</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;html</strong> <span class="hl-attribute" style="color: #F5844C">xmlns</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/1999/xhtml"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;head&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;meta</strong> <span class="hl-attribute" style="color: #F5844C">charset</span>=<span class="hl-value" style="color: #993300">"utf-8"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;title&gt;</strong>Some cities in the UK<strong class="hl-tag" style="color: #000096">&lt;/title&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;script</strong> <span class="hl-attribute" style="color: #F5844C">defer</span>=<span class="hl-value" style="color: #993300">"defer"</span> <span class="hl-attribute" style="color: #F5844C">src</span>=<span class="hl-value" style="color: #993300">"cities.js"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;link</strong> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"../style.css"</span> <span class="hl-attribute" style="color: #F5844C">rel</span>=<span class="hl-value" style="color: #993300">"stylesheet"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;link</strong> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"cities.css"</span> <span class="hl-attribute" style="color: #F5844C">rel</span>=<span class="hl-value" style="color: #993300">"stylesheet"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;/head&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;body&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;p&gt;</strong>[<strong class="hl-tag" style="color: #000096">&lt;a</strong> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"/"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>Home<strong class="hl-tag" style="color: #000096">&lt;/a&gt;</strong>]<strong class="hl-tag" style="color: #000096">&lt;/p&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;h1&gt;</strong>Some cities in the UK<strong class="hl-tag" style="color: #000096">&lt;/h1&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;table&gt;</strong>
         <strong class="hl-tag" style="color: #000096">&lt;thead&gt;</strong>
            <strong class="hl-tag" style="color: #000096">&lt;tr&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;th&gt;</strong>City<strong class="hl-tag" style="color: #000096">&lt;/th&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;th&gt;</strong>Country<strong class="hl-tag" style="color: #000096">&lt;/th&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;th&gt;</strong>Latitude<strong class="hl-tag" style="color: #000096">&lt;/th&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;th&gt;</strong>Longitude<strong class="hl-tag" style="color: #000096">&lt;/th&gt;</strong>
            <strong class="hl-tag" style="color: #000096">&lt;/tr&gt;</strong>
         <strong class="hl-tag" style="color: #000096">&lt;/thead&gt;</strong>
         <strong class="hl-tag" style="color: #000096">&lt;tbody&gt;</strong>
            <strong class="hl-tag" style="color: #000096">&lt;tr&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>Abbots Langley<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>England<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>51.701 <strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>-0.416 <strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
            <strong class="hl-tag" style="color: #000096">&lt;/tr&gt;</strong>
            <strong class="hl-tag" style="color: #000096">&lt;tr&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>Aberaman<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>Wales<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>51.7   <strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>-3.4333<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
            <strong class="hl-tag" style="color: #000096">&lt;/tr&gt;</strong>
…
            <strong class="hl-tag" style="color: #000096">&lt;tr&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>Addlestone<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>England<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>51.3695<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
               <strong class="hl-tag" style="color: #000096">&lt;td&gt;</strong>-0.4901<strong class="hl-tag" style="color: #000096">&lt;/td&gt;</strong>
            <strong class="hl-tag" style="color: #000096">&lt;/tr&gt;</strong>
         <strong class="hl-tag" style="color: #000096">&lt;/tbody&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/table&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;p&gt;</strong>Load <strong class="hl-tag" style="color: #000096">&lt;button</strong> <span class="hl-attribute" style="color: #F5844C">id</span>=<span class="hl-value" style="color: #993300">"more"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>More<strong class="hl-tag" style="color: #000096">&lt;/button&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;/p&gt;</strong>
   <strong class="hl-tag" style="color: #000096">&lt;/body&gt;</strong>
<strong class="hl-tag" style="color: #000096">&lt;/html&gt;</strong></pre><p>How does it work? The <code class="code">page</code> command loads the page, the <code class="code">pause</code> command
waits for half a second so the browser has a chance to fill the table, and the <code class="code">output</code>
command sends the current page DOM to the <code class="code">result</code> port.</p><p>We can also interact with the page. This script:</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;p:declare-step</strong> <span class="hl-attribute" style="color: #F5844C">xmlns:p</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/ns/xproc"</span>&#xD;
                <span class="hl-attribute" style="color: #F5844C">xmlns:cx</span>=<span class="hl-value" style="color: #993300">"http://xmlcalabash.com/ns/extensions"</span>&#xD;
                <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"main"</span> <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"3.1"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;p:import</strong> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"https://xmlcalabash.com/ext/library/selenium.xpl"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;p:output</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;p:option</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"uri"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>&#xD;
&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;cx:selenium&gt;</strong>&#xD;
    <strong class="hl-tag" style="color: #000096">&lt;p:with-option</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"arguments"</span> <span class="hl-attribute" style="color: #F5844C">select</span>=<span class="hl-value" style="color: #993300">"('--headless')"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>&#xD;
    <strong class="hl-tag" style="color: #000096">&lt;p:with-input&gt;</strong>&#xD;
      <strong class="hl-tag" style="color: #000096">&lt;p:inline</strong> <span class="hl-attribute" style="color: #F5844C">content-type</span>=<span class="hl-value" style="color: #993300">"text/plain"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>script version 0.2 .&#xD;
      page "{$uri}" .&#xD;
&#xD;
      find $button by id = "more" .&#xD;
      click $button .&#xD;
      pause PT0.5S .&#xD;
&#xD;
      output to result .&#xD;
      <strong class="hl-tag" style="color: #000096">&lt;/p:inline&gt;</strong>&#xD;
    <strong class="hl-tag" style="color: #000096">&lt;/p:with-input&gt;</strong>&#xD;
  <strong class="hl-tag" style="color: #000096">&lt;/cx:selenium&gt;</strong>&#xD;
<strong class="hl-tag" style="color: #000096">&lt;/p:declare-step&gt;</strong>&#xD;
</pre><p>Finds the button on the page with the id “more”, clicks it, waits, then returns the page.
That will return the second page of results.</p><p>As a final example, consider this script:</p><pre class="programlisting" xml:space="preserve">script version 0.2 .
page "{$uri}" .

until "not(empty($row))" do
  find $row by selector = "table tbody tr" .
  pause PT0.25S .
done

# Search for $city, hit more until we find it
find $city by xpath = "//td[. = '{$city}']".
while "empty($city)" do
  call clickNext .
  find $city by xpath = "//td[. = '{$city}']".
done

find $row by xpath "//tr[td[. = '{$city}']]" .

output xpath "normalize-space(replace($row/*:td[3], ' ', ' '))" to result .
output xpath "normalize-space(replace($row/h:td[4], ' ', ' '))" to result .

close .

subroutine clickNext
   find $button by selector = "button" .
   scroll to $button .
   click $button .
   pause PT0.25S .
end</pre><p>This script:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Loads the page.
</p></li><li class="listitem"><p>Waits until the table has data, rather than assuming 0.5s will be long enough.
</p></li><li class="listitem"><p>Looks for the city with an XPath expression. While it isn’t present,
it uses a subroutine to click the next button.
</p></li><li class="listitem"><p>If we’ve found the city, we get its row.
</p></li><li class="listitem"><p>Then we output the latitude and longitude after doing a little cleanup.
</p></li><li class="listitem"><p>Then we close the browser.
</p></li><li class="listitem"><p>The “clickNext” subroutine scrolls finds the button, scrolls to it, clicks it,
and wait’s ¼s.
</p></li></ol></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar07s03.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="markupuk2025.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar07s05.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>