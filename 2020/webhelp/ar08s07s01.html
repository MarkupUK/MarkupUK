
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>True 3D models and view rotation</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2019 Proceedings" /><link rel="up" href="ar08s07.html" title="Developments" /><link rel="prev" href="ar08s07.html" title="Developments" /><link rel="next" href="ar08s07s02.html" title="Collision detection, a.k.a. train crashes" /><!--  Generated with Oxygen version 21.0, build number 2019032613.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.1.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2019032613" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar08s07.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar08s07s02.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="sect2" id="d5e4041"><div class="titlepage"><div><div><h3 class="title">True 3D models and view rotation</h3></div></div></div><p>The 3D model used so far is a collection of orthogonally arranged rectangular blocks and cylinders, declared in an order that
                reflects isometric view shadowing. For example an <span class="emphasis"><em>engine frame</em></span> block is defined before the
                    <span class="emphasis"><em>boiler</em></span> cylinder, to appear underneath it. From this model suitable SVG components can be generated to
                simulate a 3D view when subjected to a uniform isometric transformation. But to support a non-orthogonal rotation of such a model
                about the z-axis, to overcome the <span class="quote">“<span class="quote">on the ceiling</span>”</span> effect, the situation becomes somewhat more complex. There are three
                points to consider: </p><div xmlns:svg="http://www.w3.org/2000/svg" class="itemizedlist"><ul class="itemizedlist" style=""><li class="listitem"><p>What is a suitable graphic for a block or cylinder when rotated by θ degrees about the z-axis? A key requirement is that the
                            <span class="quote">“<span class="quote">faces</span>”</span> model of additional styling and content must still be supported.</p></li><li class="listitem"><p>As a group of 3D parts is rotated, their obscuration relationships alter and any views must accommodate this. How should a
                        set of component parts be <span class="quote">“<span class="quote">depth-ordered</span>”</span> in the direction of the isometric view, when the ensemble is rotated
                        significantly?</p></li><li class="listitem"><p>How is the appropriate rotated view displayed as a locomotive turns?</p></li></ul></div><p>Constructing the isometric-prepared components of a rotated block is a little tricky. The top surface is always visible and can just
                be rotated as required. Ignoring any visibility of the base, only two of the four vertical sides will be visible dependent upon
                rotation change ranges of 45° and 135°. Each visible face is subjected to additional scaling and skew dependent on the rotation angle,
                so that it is correctly sized, positioned and any additional content <span class="quote">“<span class="quote">stays in place</span>”</span>. The situation for horizontally
                aligned cylinders is very much more complex, and at the time of writing is work in progress.</p><p>To <span class="quote">“<span class="quote">view-order</span>”</span> an ensemble of rotated components it would be helpful if a (possibly multiple) value can be computed
                that can be used as sort keys to arrange the parts into appropriate order using <code class="code">xsl:perform-sort/xsl:sort+</code>. This can be
                so for some very simple cases, but in general parts must be pairwise-compared, which requires some sorting function that uses a
                    <span class="emphasis"><em>compare</em></span> function, rather than a key-generator. Sadly, XPath sort functions all use a <span class="quote">“<span class="quote">key</span>”</span>
                model, so a generic XSLT higher-order pairwise sorting function may have to be constructed.</p><p>Calculating the rotation views <span class="emphasis"><em>on the fly</em></span> would be catastrophically expensive, so the solution chosen is to
                generate a series of groups, each corresponding to a defined angle of rotation and labelled suitably (e.g.
                    <code class="code">class="rotate-45"</code> for a view rotated by -45°). It would also be possible to generate the set of views offline and
                include in the runtime. However they can be sizeable — an interval of 5°, which certainly doesn't appear <span class="quote">“<span class="quote">smooth</span>”</span> would
                require 72 separate versions.</p><p>Assuming there is such a series of views of an engine, we need to arrange for the display property of the (approximately) correct
                rotation view to be switched from <span class="emphasis"><em>none</em></span> to <span class="emphasis"><em>inline</em></span>. But we do know for a given locomotive
                which section it is in and can map from the proportion of the animation completed to the tangential orientation at that point. (As we
                use only straights and circular arcs, the tangent angle is a piecewise linear function of the <span class="quote">“<span class="quote">section proportion</span>”</span>,
                running from 0 to 1. This profile is added to the map entry for the section.) Given that the speed of the engine is known, we can thus
                predict how long it will be until the current rotation view should be superseded by the next one. This is enabled through a template
                    <code class="code">rotateTrain</code> which both makes visible the suitable view and schedules a further <code class="code">rotateTrain</code> call after a
                suitable wait. </p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar08s07.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="ar08s07.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar08s07s02.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>