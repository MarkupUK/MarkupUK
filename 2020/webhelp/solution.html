
<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xhtml="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Solution</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><link rel="home" href="oxygen-main.html" title="Markup UK 2019 Proceedings" /><link rel="up" href="ar03.html" title="xprocedit, A Browser-Based Open-Source XProc Editor" /><link rel="prev" href="ar03s03.html" title="Selecting a Graph Editing Framework" /><link rel="next" href="ar03s05.html" title="Other Visual XProc Editors" /><!--  Generated with Oxygen version 21.0, build number 2019032613.  --><link rel="stylesheet" type="text/css" href="oxygen-webhelp/resources/css/webhelp_topic.css"><!----></link><script type="text/javascript" xml:space="preserve"><!--
          
          var prefix = "index.html";
          
          --></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery-3.1.1.min.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.cookie.js" xml:space="preserve"><!----></script><script type="text/javascript" src="oxygen-webhelp/resources/js/jquery.highlight-3.js" xml:space="preserve"><!----></script><script type="text/javascript" charset="utf-8" src="oxygen-webhelp/resources/js/webhelp_topic.js?buildId=2019032613" xml:space="preserve"><!----></script></head><body onload="highlightSearchTerm()" class="frmBody"><div class="navheader"><table width="100%" summary="Navigation header"><tr><td colspan="3" rowspan="1"><form name="searchForm" id="searchForm" action="javascript:void(0)" onsubmit="parent.tocwin.SearchToc(this);" method="get" enctype="application/x-www-form-urlencoded"><!----><input type="text" id="textToSearch" name="textToSearch" class="textToSearch" size="30" placeholder="Search" /><!----></form></td></tr><tr><td width="20%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar03s03.html" shape="rect">Prev</a></span> </td><th width="60%" align="center" rowspan="1" colspan="1"> </th><td width="20%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar03s05.html" shape="rect">Next</a></span></td></tr></table><hr /></div><div class="section" id="solution"><div class="titlepage"><div><div><h2 class="title" style="clear: both">Solution</h2></div></div></div><p>The solution, called xprocedit [<a class="citation" href="marco-references.html#d5e1913" shape="rect"><span class="citation">xprocedit</span></a>], consists of an extension to the JointJS shape model in
      order to accommodate different kinds of XProc steps (atomic, compound, multicontainer; standard/user-defined),
      primary/non-primary ports, and options that act like input ports but are displayed differently and can have default
      values.</p><p>More details are given in one of the author’s master’s thesis [<a class="citation" href="marco-references.html#d5e1862" shape="rect"><span class="citation">GeueMT</span></a>].</p><p>XProc 3.0 is currently in the later stages of being specified. One XProc 1.0 concept that 3.0 does away with is
      parameter ports. It was decided that parameter ports will not be supported by xprocedit. However, for pipelines that don’t
      use parameter ports, an XProc 1.0 serialization is still available. This is because the generated pipelines need to be
      tested but XProc 3.0 processors are not widespread yet. Support for XDM 3.1 maps, which serve as a replacement for
      parameter ports when supplied as a parameter option, is currently being implemented in xprocedit. It should be possible,
      if users are interested and if funding is available, to use xprocedit as an XProc 1.0→3.0 migration tool, converting
      parameter ports to map options during import. </p><p>An issue where an interactive editor may help is validation, or rather, forcing the user to only create valid
      pipelines. Ideally, a graphical pipeline editor will not, for example, let users connect two steps with a directed edge
      that points from input to output, from input to input, or from a step to itself. Another check that is built into the
      tooling might prevent users from connecting an output port that may emit multiple documents to an input port that only
      accepts a single document. To that end, a certain amount of custom Javascript application logic had to be employed, and
      this is not finished yet. Verifying that the declared content types of an output port match the content types that an
      input port accepts is another future custom Javascript validation that is interesting in designing XProc 3.0 pipelines
      with their support for non-XML documents.</p><p>Some constraints, such as whether there are no loops in the pipeline or whether all required inputs are connected,
      are currently only checked upon export, via XSLT, and with poor error reporting.</p><p>As mentioned in the previous section, export from the internal Javascript model via its JSON serialization is performed
    by XSLT 3.0 transformations in the browser, starting from the result of applying <code class="code">fn:json-to-xml()</code> to the JSON
    model.</p><p>The framework maintains an internal Javascript object representation of the graph. It was decided that the XProc XML
      document be generated from the JSON serialization of this model, rather than from the SVG rendering. The main reason is
      that, although the JSON representation also contains some layout information, it is considered as more stable than an SVG
      rendering. The tool that was chosen for generating the XProc XML document, Saxon-JS, supports XSLT 3 and XPath 3.1, and
      therefore it is equally capable of transforming JSON documents to XML as it is capable of transforming SVG to another XML
      vocabulary. What finally tipped the scale in favour of converting JSON rather than SVG to XProc was symmetry: There also
      needs to be an import process that imports pipelines and step libraries to the internal model, which is Javascript/JSON
      rather than SVG.</p><p>An important aspect when generating pipelines for future human editing in XML format is this: There can be multiple
      equivalent XML representations of a given graph. Consider the following pipeline (<a class="xref" href="solution.html#fig_xslt_pipeline" title="Figure 1. A Simple XSLT Pipeline" shape="rect">Figure 1, “A Simple XSLT Pipeline”</a>,
      taken from [<a class="citation" href="marco-references.html#d5e1862" shape="rect"><span class="citation">GeueMT</span></a>]):</p><div class="figure" id="fig_xslt_pipeline"><p class="title"><strong>Figure 1. A Simple XSLT Pipeline</strong></p><div class="figure-contents"><div class="mediaobject"><img src="papers-2019/marco-gerrit/paper/img/simple_xslt_pipeline.png" alt="A Simple XSLT Pipeline" /></div></div></div><br class="figure-break" clear="none" /><p>When serializing this pipeline as an XProc XML document, two variants are possible:</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;p:declare-step</strong> <span class="hl-attribute" style="color: #F5844C">xmlns:p</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/ns/xproc"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:c</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/ns/xproc-step"</span> <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"1.0"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;p:output</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span> <span class="hl-attribute" style="color: #F5844C">primary</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;p:load</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"load-xsl"</span> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"test.xsl"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;p:load</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"load-xml"</span> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"test.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;p:xslt&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;p:input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"stylesheet"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;p:pipe</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span> <span class="hl-attribute" style="color: #F5844C">step</span>=<span class="hl-value" style="color: #993300">"load-xsl"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/p:input&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;p:input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"parameters"</span><strong class="hl-tag" style="color: #000096">&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;p:empty/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/p:input&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/p:xslt&gt;</strong>
  
<strong class="hl-tag" style="color: #000096">&lt;/p:declare-step&gt;</strong></pre><p>and</p><pre class="programlisting" xml:space="preserve"><strong class="hl-tag" style="color: #000096">&lt;p:declare-step</strong> <span class="hl-attribute" style="color: #F5844C">xmlns:p</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/ns/xproc"</span>
  <span class="hl-attribute" style="color: #F5844C">xmlns:c</span>=<span class="hl-value" style="color: #993300">"http://www.w3.org/ns/xproc-step"</span> <span class="hl-attribute" style="color: #F5844C">version</span>=<span class="hl-value" style="color: #993300">"1.0"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;p:output</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span> <span class="hl-attribute" style="color: #F5844C">primary</span>=<span class="hl-value" style="color: #993300">"true"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;p:load</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"load-xml"</span> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"test.xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;p:load</strong> <span class="hl-attribute" style="color: #F5844C">name</span>=<span class="hl-value" style="color: #993300">"load-xsl"</span> <span class="hl-attribute" style="color: #F5844C">href</span>=<span class="hl-value" style="color: #993300">"test.xsl"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;p:sink/&gt;</strong>
  
  <strong class="hl-tag" style="color: #000096">&lt;p:xslt&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;p:input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"source"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;p:pipe</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span> <span class="hl-attribute" style="color: #F5844C">step</span>=<span class="hl-value" style="color: #993300">"load-xml"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/p:input&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;p:input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"stylesheet"</span><strong class="hl-tag" style="color: #000096">&gt;</strong>
      <strong class="hl-tag" style="color: #000096">&lt;p:pipe</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"result"</span> <span class="hl-attribute" style="color: #F5844C">step</span>=<span class="hl-value" style="color: #993300">"load-xsl"</span><strong class="hl-tag" style="color: #000096">/&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;/p:input&gt;</strong>
    <strong class="hl-tag" style="color: #000096">&lt;p:input</strong> <span class="hl-attribute" style="color: #F5844C">port</span>=<span class="hl-value" style="color: #993300">"parameters"</span><strong class="hl-tag" style="color: #000096">&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;p:empty/&gt;</strong><strong class="hl-tag" style="color: #000096">&lt;/p:input&gt;</strong>
  <strong class="hl-tag" style="color: #000096">&lt;/p:xslt&gt;</strong>
  
<strong class="hl-tag" style="color: #000096">&lt;/p:declare-step&gt;</strong></pre><p>The first variant uses a connection between the primary output of the step named <code class="code">load-xml</code> with the
      primary input of the XSLT step, while the second variant serializes the <code class="code">p:load</code> steps in reverse order and
      therefore needs to insert a <code class="code">p:sink</code> step in between, and it needs to connect the primary input of the XSLT
      step, <code class="code">source</code>, explicitly with the primary output, <code class="code">result</code>, of <code class="code">load-xml</code>.</p><p>Unless one wants to use the x-y-coordinates as an ordering hint, the graph editor does not provide clues about the
      preferred serialization order for the <code class="code">p:load</code> steps. One possibility that was quickly rejected was to use
      another type of connectors in the 2-D graph that represent document order. The idea was rejected because it puts an
      additional burden onto the user that seems unnecessary.</p><p>Generating a serialization that makes maximum use of primary port connections is an optimization problem. The author
      addressed it by a graph traversal that favours serializing primary ports adjacently when there are multiple choices. This 
    is a heuristics that does not guarantee optimal results but solves this issue well enough.</p><p>The import mechanism has to deal with a problem that is also related to default readable ports: It needs to make
      implicit connections explicit for ports and also for options. The core of this problem has already been addressed in an
      XSLT-based XProc documentation tool whose normalized output will be converted to JointJS’s internal JSON graph model
      using Saxon-JS.</p><h3 id="d5e1800">Sub-Graphs</h3><p>The subpipelines of compound steps such as <code class="code">p:for-each</code> are displayed in their own tabs. Some bookkeeping
      in the Javascript application will make sure that they are included in the JSON representation upon export and that they
      are removed when the placeholder block in the containing graph is removed. JointJS would have permitted in-place folding
      of subpipelines, but expanding them would have quickly occupied much screen space and it would also have necessitated more
      advanced auto-layout capabilities.</p><p>Auto-layout is currently being added to the editor, its primary application being rendering the pipeline and its
      subpipelines (in separate tabs) initially after loading an existing pipeline.</p><p>For round-tripping (import, edit, export, import, …), in order to spare users the ordeal of recreating a decent layout
      in xprocedit over and over again, there is an option to preserve layout information in the serialized pipeline, using
      XProc <code class="code">p:pipeinfo</code> elements.</p><p>The application’s user interface is still under development; in March 2019 it looked like <a class="xref" href="solution.html#fig_ui" title="Figure 2. User Interface" shape="rect">Figure 2, “User Interface”</a>.</p><div class="figure" id="fig_ui"><p class="title"><strong>Figure 2. User Interface</strong></p><div class="figure-contents"><div class="mediaobject"><img src="papers-2019/marco-gerrit/paper/img/2019_03_04_screenshot.png" alt="User Interface" /></div></div></div><br class="figure-break" clear="none" /><p>The step library palettes on the left are still supplied statically as JSON structures. There will be an import
      process that processes <code class="code">p:import</code> statements and makes available the imported steps, grouped by namespace
      prefix. A difficulty that has already been solved is that imports often (in case of transpect, at least) use canonical
      import URIs that are not identical with their locations on the Web server that xprocedit runs on. A catalog resolver
      written in XSLT that runs in the browser will perform the required URI translations when recursively resolving the
      imports, and it will also restore the canonical URIs when serializing the XProc XML from the internal
      representation.</p></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left" rowspan="1" colspan="1"><span class="navprev"><a accesskey="p" href="ar03s03.html" shape="rect">Prev</a></span> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="u" href="ar03.html" shape="rect">Up</a></td><td width="40%" align="right" rowspan="1" colspan="1"> <span class="navnext"><a accesskey="n" href="ar03s05.html" shape="rect">Next</a></span></td></tr><tr><td width="40%" align="left" valign="top" rowspan="1" colspan="1"> </td><td width="20%" align="center" rowspan="1" colspan="1"><a accesskey="h" href="oxygen-main.html" shape="rect">Home</a></td><td width="40%" align="right" valign="top" rowspan="1" colspan="1"> </td></tr></table></div><div class="footer">Generated by<a class="oxyFooter" href="http://www.oxygenxml.com/xml_webhelp.html" target="_blank" shape="rect">                            
                            &lt;oXygen/&gt; XML WebHelp
                        </a></div></body></html>